<!doctype html>
<html>
<head>
  <style>
    body {
      margin: 10px;
    }
    table {
      border-collapse: collapse;
      margin-left: auto;
      margin-right: auto;
    }
    #table-wrapper {
      overflow-y: auto;
    }
    td {
      position: relative;
    }
    td:first-child {
      border-right: 1px solid gray;
    }
    tr {
      border-bottom: 1px solid gray;
    }
    tr:first-child {
      position: fixed;
      z-index: 999;
      background-color: white;
      top: 10px;
    }
    .diff-td {
      width: 10px;
      border-right: 1px solid gray;
      text-align: center;
    }
    .diff-td:hover .tooltip {
      display: block;
    }
    .tooltip {
      position: absolute;
      left: 10px;
      top: 10px;
      background-color: black;
      color: white;
      z-index: 1000;
      padding: 5px;
      text-align: center;
      display: none;
    }
    #change-avg {
      position: fixed;
    }
  </style>
</head>
<body>
  <form id="change-avg">
    Color data by average of:<br>
    <input type="radio" name="avg-basis" value="good-data" checked>Good data
    <br>
    <input type="radio" name="avg-basis" value="all-data">All data
  </form>
  <div id="table-wrapper"><table id="data-table"></table></div>
  <script>
    document.getElementsByTagName('div')[0].style.height = window.innerHeight - 22 + 'px';
    var firstTR  = document.getElementsByTagName('tr')[0];
    var secondTR = document.getElementsByTagName('tr')[1];
    var firstTD = firstTR.getElementsByTagName('td')[0];
    var secondTD = secondTR.getElementsByTagName('td')[0];
    firstTD.style.width = window.getComputedStyle(secondTD).width;
    [].forEach.call(document.querySelectorAll('input[type=radio]'), function(radio) {
      radio.addEventListener('click', function() {
        var basis = this.getAttribute('value').replace('-data','');
        [].forEach.call(document.getElementsByClassName('tooltip'), function(tooltip) {
          var td = tooltip.parentElement;
          var bgc = td.style.backgroundColor;
          var r = bgc.match(/[0-9]+/g)[0];
          var g = bgc.match(/[0-9]+/g)[1];
          var b = bgc.match(/[0-9]+/g)[2];
          var a;
          if(basis === 'all') {
            a = td.dataset['allAvg'];
          } else {
            var allDateListings = td.parentElement.getElementsByClassName('date-listing');
            a = tooltip.getElementsByClassName('date-listing').length / allDateListings.length;
          }
          td.style.backgroundColor = 'rgba('+r+','+g+','+b+','+a+')';
        });
      }, false);
    });
  </script>
</body>
</html>
